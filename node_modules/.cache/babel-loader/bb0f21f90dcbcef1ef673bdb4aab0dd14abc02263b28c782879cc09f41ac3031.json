{"ast":null,"code":"import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport { APIRoute, AppRoute, AuthorizationStatus, NameSpace } from '../../const';\nimport { setToken, deleteToken } from '../../services/token';\nimport { redirectToRoute } from '../actions/action';\nconst initialState = {\n  authorizationStatus: AuthorizationStatus.Unknown\n};\nexport const checkAuthAction = createAsyncThunk('user/checkAuth', async (_arg, _ref) => {\n  let {\n    extra: api\n  } = _ref;\n  await api.get(APIRoute.Login);\n});\nexport const loginAction = createAsyncThunk('user/login', async (_ref2, _ref3) => {\n  let {\n    login: email,\n    password\n  } = _ref2;\n  let {\n    dispatch,\n    extra: api\n  } = _ref3;\n  const {\n    data: {\n      token\n    }\n  } = await api.post(APIRoute.Login, {\n    email,\n    password\n  });\n  setToken(token);\n  dispatch(redirectToRoute(AppRoute.Root));\n});\nexport const logoutAction = createAsyncThunk('user/logout', async (_arg, _ref4) => {\n  let {\n    dispatch,\n    extra: api\n  } = _ref4;\n  await api.delete(APIRoute.Logout);\n  deleteToken();\n  dispatch(redirectToRoute(AppRoute.Root));\n});\nexport const userProcess = createSlice({\n  name: NameSpace.User,\n  initialState,\n  reducers: {},\n  extraReducers(builder) {\n    builder.addCase(checkAuthAction.fulfilled, state => {\n      state.authorizationStatus = AuthorizationStatus.Auth;\n    }).addCase(checkAuthAction.rejected, state => {\n      state.authorizationStatus = AuthorizationStatus.NoAuth;\n    }).addCase(loginAction.fulfilled, state => {\n      state.authorizationStatus = AuthorizationStatus.Auth;\n    }).addCase(loginAction.rejected, state => {\n      state.authorizationStatus = AuthorizationStatus.NoAuth;\n    }).addCase(logoutAction.fulfilled, state => {\n      state.authorizationStatus = AuthorizationStatus.NoAuth;\n    });\n  }\n});","map":{"version":3,"names":["createAsyncThunk","createSlice","APIRoute","AppRoute","AuthorizationStatus","NameSpace","setToken","deleteToken","redirectToRoute","initialState","authorizationStatus","Unknown","checkAuthAction","_arg","_ref","extra","api","get","Login","loginAction","_ref2","_ref3","login","email","password","dispatch","data","token","post","Root","logoutAction","_ref4","delete","Logout","userProcess","name","User","reducers","extraReducers","builder","addCase","fulfilled","state","Auth","rejected","NoAuth"],"sources":["/Users/farkhadov950405/Desktop/HTML_Academy/Projects/WhatToWatch/853355-what-to-watch-12/src/store/user-process/user-process.ts"],"sourcesContent":["import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport { APIRoute, AppRoute, AuthorizationStatus, NameSpace } from '../../const';\nimport { AppDispatch, State, UserProcess } from '../../types/state';\nimport { AxiosInstance } from 'axios';\nimport { setToken, deleteToken } from '../../services/token';\nimport { AuthData } from '../../types/auth-data';\nimport { UserData } from '../../types/user-data';\nimport { redirectToRoute } from '../actions/action';\n\nconst initialState: UserProcess = {\n  authorizationStatus: AuthorizationStatus.Unknown,\n};\n\nexport const checkAuthAction = createAsyncThunk<void, undefined, {\n  dispatch: AppDispatch;\n  state: State;\n  extra: AxiosInstance;\n}>(\n  'user/checkAuth',\n  async (_arg, {extra: api}) => {\n    await api.get(APIRoute.Login);\n  },\n);\n\nexport const loginAction = createAsyncThunk<void, AuthData, {\n  dispatch: AppDispatch;\n  state: State;\n  extra: AxiosInstance;\n}>(\n  'user/login',\n  async({login: email, password}, {dispatch, extra: api}) => {\n    const {data: {token}} = await api.post<UserData>(APIRoute.Login, {email, password});\n    setToken(token);\n    dispatch(redirectToRoute(AppRoute.Root));\n  }\n);\n\nexport const logoutAction = createAsyncThunk<void, undefined, {\n  dispatch: AppDispatch;\n  state: State;\n  extra: AxiosInstance;\n}>(\n  'user/logout',\n  async (_arg, {dispatch, extra: api}) => {\n    await api.delete(APIRoute.Logout);\n    deleteToken();\n    dispatch(redirectToRoute(AppRoute.Root));\n  },\n);\n\nexport const userProcess = createSlice({\n  name: NameSpace.User,\n  initialState,\n  reducers: {},\n  extraReducers(builder) {\n    builder\n      .addCase(checkAuthAction.fulfilled, (state) => {\n        state.authorizationStatus = AuthorizationStatus.Auth;\n      })\n      .addCase(checkAuthAction.rejected, (state) => {\n        state.authorizationStatus = AuthorizationStatus.NoAuth;\n      })\n      .addCase(loginAction.fulfilled, (state) => {\n        state.authorizationStatus = AuthorizationStatus.Auth;\n      })\n      .addCase(loginAction.rejected, (state) => {\n        state.authorizationStatus = AuthorizationStatus.NoAuth;\n      })\n      .addCase(logoutAction.fulfilled, (state) => {\n        state.authorizationStatus = AuthorizationStatus.NoAuth;\n      });\n  }\n});\n"],"mappings":"AAAA,SAASA,gBAAgB,EAAEC,WAAW,QAAQ,kBAAkB;AAChE,SAASC,QAAQ,EAAEC,QAAQ,EAAEC,mBAAmB,EAAEC,SAAS,QAAQ,aAAa;AAGhF,SAASC,QAAQ,EAAEC,WAAW,QAAQ,sBAAsB;AAG5D,SAASC,eAAe,QAAQ,mBAAmB;AAEnD,MAAMC,YAAyB,GAAG;EAChCC,mBAAmB,EAAEN,mBAAmB,CAACO;AAC3C,CAAC;AAED,OAAO,MAAMC,eAAe,GAAGZ,gBAAgB,CAK7C,gBAAgB,EAChB,OAAOa,IAAI,EAAAC,IAAA,KAAmB;EAAA,IAAjB;IAACC,KAAK,EAAEC;EAAG,CAAC,GAAAF,IAAA;EACvB,MAAME,GAAG,CAACC,GAAG,CAACf,QAAQ,CAACgB,KAAK,CAAC;AAC/B,CAAC,CACF;AAED,OAAO,MAAMC,WAAW,GAAGnB,gBAAgB,CAKzC,YAAY,EACZ,OAAAoB,KAAA,EAAAC,KAAA,KAA2D;EAAA,IAArD;IAACC,KAAK,EAAEC,KAAK;IAAEC;EAAQ,CAAC,GAAAJ,KAAA;EAAA,IAAE;IAACK,QAAQ;IAAEV,KAAK,EAAEC;EAAG,CAAC,GAAAK,KAAA;EACpD,MAAM;IAACK,IAAI,EAAE;MAACC;IAAK;EAAC,CAAC,GAAG,MAAMX,GAAG,CAACY,IAAI,CAAW1B,QAAQ,CAACgB,KAAK,EAAE;IAACK,KAAK;IAAEC;EAAQ,CAAC,CAAC;EACnFlB,QAAQ,CAACqB,KAAK,CAAC;EACfF,QAAQ,CAACjB,eAAe,CAACL,QAAQ,CAAC0B,IAAI,CAAC,CAAC;AAC1C,CAAC,CACF;AAED,OAAO,MAAMC,YAAY,GAAG9B,gBAAgB,CAK1C,aAAa,EACb,OAAOa,IAAI,EAAAkB,KAAA,KAA6B;EAAA,IAA3B;IAACN,QAAQ;IAAEV,KAAK,EAAEC;EAAG,CAAC,GAAAe,KAAA;EACjC,MAAMf,GAAG,CAACgB,MAAM,CAAC9B,QAAQ,CAAC+B,MAAM,CAAC;EACjC1B,WAAW,EAAE;EACbkB,QAAQ,CAACjB,eAAe,CAACL,QAAQ,CAAC0B,IAAI,CAAC,CAAC;AAC1C,CAAC,CACF;AAED,OAAO,MAAMK,WAAW,GAAGjC,WAAW,CAAC;EACrCkC,IAAI,EAAE9B,SAAS,CAAC+B,IAAI;EACpB3B,YAAY;EACZ4B,QAAQ,EAAE,CAAC,CAAC;EACZC,aAAaA,CAACC,OAAO,EAAE;IACrBA,OAAO,CACJC,OAAO,CAAC5B,eAAe,CAAC6B,SAAS,EAAGC,KAAK,IAAK;MAC7CA,KAAK,CAAChC,mBAAmB,GAAGN,mBAAmB,CAACuC,IAAI;IACtD,CAAC,CAAC,CACDH,OAAO,CAAC5B,eAAe,CAACgC,QAAQ,EAAGF,KAAK,IAAK;MAC5CA,KAAK,CAAChC,mBAAmB,GAAGN,mBAAmB,CAACyC,MAAM;IACxD,CAAC,CAAC,CACDL,OAAO,CAACrB,WAAW,CAACsB,SAAS,EAAGC,KAAK,IAAK;MACzCA,KAAK,CAAChC,mBAAmB,GAAGN,mBAAmB,CAACuC,IAAI;IACtD,CAAC,CAAC,CACDH,OAAO,CAACrB,WAAW,CAACyB,QAAQ,EAAGF,KAAK,IAAK;MACxCA,KAAK,CAAChC,mBAAmB,GAAGN,mBAAmB,CAACyC,MAAM;IACxD,CAAC,CAAC,CACDL,OAAO,CAACV,YAAY,CAACW,SAAS,EAAGC,KAAK,IAAK;MAC1CA,KAAK,CAAChC,mBAAmB,GAAGN,mBAAmB,CAACyC,MAAM;IACxD,CAAC,CAAC;EACN;AACF,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}