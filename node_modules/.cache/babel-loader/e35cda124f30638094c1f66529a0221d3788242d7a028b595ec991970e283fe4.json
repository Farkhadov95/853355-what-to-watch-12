{"ast":null,"code":"import _regeneratorRuntime from\"/Users/farkhadov950405/Desktop/HTML_Academy/Projects/WhatToWatch/853355-what-to-watch-12/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/farkhadov950405/Desktop/HTML_Academy/Projects/WhatToWatch/853355-what-to-watch-12/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{createAsyncThunk,createSlice}from'@reduxjs/toolkit';import{APIRoute,AppRoute,AuthorizationStatus,NameSpace}from'../../const';import{setToken,deleteToken}from'../../services/token';import{redirectToRoute}from'../actions/action';var initialState={authorizationStatus:AuthorizationStatus.Unknown};export var checkAuthAction=createAsyncThunk('user/checkAuth',/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_arg,_ref){var api;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:api=_ref.extra;_context.next=3;return api.get(APIRoute.Login);case 3:case\"end\":return _context.stop();}},_callee);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}());export var loginAction=createAsyncThunk('user/login',/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(_ref3,_ref4){var email,password,dispatch,api,_yield$api$post,token;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:email=_ref3.login,password=_ref3.password;dispatch=_ref4.dispatch,api=_ref4.extra;_context2.next=4;return api.post(APIRoute.Login,{email:email,password:password});case 4:_yield$api$post=_context2.sent;token=_yield$api$post.data.token;setToken(token);dispatch(redirectToRoute(AppRoute.Root));case 8:case\"end\":return _context2.stop();}},_callee2);}));return function(_x3,_x4){return _ref5.apply(this,arguments);};}());export var logoutAction=createAsyncThunk('user/logout',/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(_arg,_ref6){var dispatch,api;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:dispatch=_ref6.dispatch,api=_ref6.extra;_context3.next=3;return api.delete(APIRoute.Logout);case 3:deleteToken();dispatch(redirectToRoute(AppRoute.Root));case 5:case\"end\":return _context3.stop();}},_callee3);}));return function(_x5,_x6){return _ref7.apply(this,arguments);};}());export var userProcess=createSlice({name:NameSpace.User,initialState:initialState,reducers:{},extraReducers:function extraReducers(builder){builder.addCase(checkAuthAction.fulfilled,function(state){state.authorizationStatus=AuthorizationStatus.Auth;}).addCase(checkAuthAction.rejected,function(state){state.authorizationStatus=AuthorizationStatus.NoAuth;}).addCase(loginAction.fulfilled,function(state){state.authorizationStatus=AuthorizationStatus.Auth;}).addCase(loginAction.rejected,function(state){state.authorizationStatus=AuthorizationStatus.NoAuth;}).addCase(logoutAction.fulfilled,function(state){state.authorizationStatus=AuthorizationStatus.NoAuth;});}});","map":{"version":3,"names":["createAsyncThunk","createSlice","APIRoute","AppRoute","AuthorizationStatus","NameSpace","setToken","deleteToken","redirectToRoute","initialState","authorizationStatus","Unknown","checkAuthAction","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_arg","_ref","api","wrap","_callee$","_context","prev","next","extra","get","Login","stop","_x","_x2","apply","arguments","loginAction","_ref5","_callee2","_ref3","_ref4","email","password","dispatch","_yield$api$post","token","_callee2$","_context2","login","post","sent","data","Root","_x3","_x4","logoutAction","_ref7","_callee3","_ref6","_callee3$","_context3","delete","Logout","_x5","_x6","userProcess","name","User","reducers","extraReducers","builder","addCase","fulfilled","state","Auth","rejected","NoAuth"],"sources":["/Users/farkhadov950405/Desktop/HTML_Academy/Projects/WhatToWatch/853355-what-to-watch-12/src/store/user-process/user-process.ts"],"sourcesContent":["import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport { APIRoute, AppRoute, AuthorizationStatus, NameSpace } from '../../const';\nimport { AppDispatch, State, UserProcess } from '../../types/state';\nimport { AxiosInstance } from 'axios';\nimport { setToken, deleteToken } from '../../services/token';\nimport { AuthData } from '../../types/auth-data';\nimport { UserData } from '../../types/user-data';\nimport { redirectToRoute } from '../actions/action';\n\nconst initialState: UserProcess = {\n  authorizationStatus: AuthorizationStatus.Unknown,\n};\n\nexport const checkAuthAction = createAsyncThunk<void, undefined, {\n  dispatch: AppDispatch;\n  state: State;\n  extra: AxiosInstance;\n}>(\n  'user/checkAuth',\n  async (_arg, {extra: api}) => {\n    await api.get(APIRoute.Login);\n  },\n);\n\nexport const loginAction = createAsyncThunk<void, AuthData, {\n  dispatch: AppDispatch;\n  state: State;\n  extra: AxiosInstance;\n}>(\n  'user/login',\n  async({login: email, password}, {dispatch, extra: api}) => {\n    const {data: {token}} = await api.post<UserData>(APIRoute.Login, {email, password});\n    setToken(token);\n    dispatch(redirectToRoute(AppRoute.Root));\n  }\n);\n\nexport const logoutAction = createAsyncThunk<void, undefined, {\n  dispatch: AppDispatch;\n  state: State;\n  extra: AxiosInstance;\n}>(\n  'user/logout',\n  async (_arg, {dispatch, extra: api}) => {\n    await api.delete(APIRoute.Logout);\n    deleteToken();\n    dispatch(redirectToRoute(AppRoute.Root));\n  },\n);\n\nexport const userProcess = createSlice({\n  name: NameSpace.User,\n  initialState,\n  reducers: {},\n  extraReducers(builder) {\n    builder\n      .addCase(checkAuthAction.fulfilled, (state) => {\n        state.authorizationStatus = AuthorizationStatus.Auth;\n      })\n      .addCase(checkAuthAction.rejected, (state) => {\n        state.authorizationStatus = AuthorizationStatus.NoAuth;\n      })\n      .addCase(loginAction.fulfilled, (state) => {\n        state.authorizationStatus = AuthorizationStatus.Auth;\n      })\n      .addCase(loginAction.rejected, (state) => {\n        state.authorizationStatus = AuthorizationStatus.NoAuth;\n      })\n      .addCase(logoutAction.fulfilled, (state) => {\n        state.authorizationStatus = AuthorizationStatus.NoAuth;\n      });\n  }\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}